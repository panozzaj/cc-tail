#!/usr/bin/env bash
# Wrapper for cc-tail - calls the Node.js implementation

# Load nvm if node isn't available (non-interactive shells)
if ! command -v node &> /dev/null; then
    export NVM_DIR="${NVM_DIR:-$HOME/.nvm}"
    [ -s "$NVM_DIR/nvm.sh" ] && source "$NVM_DIR/nvm.sh"
fi

if ! command -v node &> /dev/null; then
    echo "Error: node not found. Install Node.js or configure nvm." >&2
    exit 1
fi

# Resolve symlinks to find the real script location
SCRIPT_PATH="$0"
while [ -L "$SCRIPT_PATH" ]; do
    SCRIPT_DIR="$(cd "$(dirname "$SCRIPT_PATH")" && pwd)"
    SCRIPT_PATH="$(readlink "$SCRIPT_PATH")"
    [[ "$SCRIPT_PATH" != /* ]] && SCRIPT_PATH="$SCRIPT_DIR/$SCRIPT_PATH"
done
SCRIPT_DIR="$(cd "$(dirname "$SCRIPT_PATH")" && pwd)"

exec node "$SCRIPT_DIR/src/index.js" "$@"
